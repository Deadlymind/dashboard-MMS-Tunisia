import InfoForm from "@/components/InfoForm";
export const dynamic = "force-dynamic";

async function getClient(id: string){
  const r = await fetch(`http://127.0.0.1:8000/api/v1/exploitation/clients/${id}/`, { cache:"no-store", headers:{Accept:"application/json"}});
  if(!r.ok) return null;
  return r.json();
}
async function getChoices(){
  const r = await fetch("http://127.0.0.1:8000/api/v1/exploitation/clients/choices/", { cache:"no-store" });
  if(!r.ok) return { person_types:[], formes_juridiques:[], statuts:[], countries:[] };
  return r.json();
}

type Params = Promise<{ id: string }>;

export default async function Page({ params }:{ params: Params }){
  const p = await params;                          // ‚Üê await params
  const [client, choices] = await Promise.all([getClient(p.id), getChoices()]);
  return <InfoForm id={p.id} initial={client} choices={choices}/>;
}
